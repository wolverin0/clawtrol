<% content_for :title, "üì¶ Archived - #{@board.name} - clawdeck" %>
<% @board_page = true %>

<div class="h-full flex flex-col">
  <%# Board Header - reusing the same header partial %>
  <%= render "boards/header" %>

  <%# Archived Content Area %>
  <div class="flex-1 overflow-auto bg-bg-base">
    <div class="max-w-5xl mx-auto px-6 py-6">
      <%# Page Title & Back Link %>
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
          <%= link_to board_path(@board), class: "text-content-muted hover:text-content transition-colors" do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
            </svg>
          <% end %>
          <h1 class="text-xl font-semibold text-content font-display">
            üì¶ Archived Tasks
          </h1>
          <span class="text-sm text-content-muted">(<%= @archived_count %> total)</span>
        </div>
      </div>

      <% if @archived_tasks.any? %>
        <%# Tasks Table %>
        <div class="bg-bg-surface border border-border rounded-lg overflow-hidden">
          <table class="w-full">
            <thead class="bg-bg-elevated border-b border-border">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-semibold text-content-muted uppercase tracking-wider">ID</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-content-muted uppercase tracking-wider">Task</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-content-muted uppercase tracking-wider hidden sm:table-cell">Priority</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-content-muted uppercase tracking-wider hidden md:table-cell">Archived</th>
                <th class="px-4 py-3 text-right text-xs font-semibold text-content-muted uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-border">
              <% @archived_tasks.each do |task| %>
                <tr class="hover:bg-bg-hover transition-colors">
                  <td class="px-4 py-3 text-sm text-content-muted">#<%= task.id %></td>
                  <td class="px-4 py-3">
                    <%= link_to board_task_path(@board, task), data: { turbo_frame: "task_panel" }, class: "text-sm text-content hover:text-accent transition-colors" do %>
                      <%= task.name.truncate(60) %>
                    <% end %>
                    <% if task.tags.present? && task.tags.any? %>
                      <div class="flex flex-wrap gap-1 mt-1">
                        <% task.tags.first(3).each do |tag| %>
                          <span class="inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-bg-elevated text-content-secondary">
                            <%= tag %>
                          </span>
                        <% end %>
                        <% if task.tags.size > 3 %>
                          <span class="text-[10px] text-content-muted">+<%= task.tags.size - 3 %></span>
                        <% end %>
                      </div>
                    <% end %>
                  </td>
                  <td class="px-4 py-3 hidden sm:table-cell">
                    <% flame_count = case task.priority
                      when "high" then 3
                      when "medium" then 2
                      when "low" then 1
                      else 0
                    end %>
                    <% flame_color = case task.priority
                      when "high" then "text-accent"
                      when "medium" then "text-orange-500"
                      when "low" then "text-yellow-500"
                      else "text-content-muted/50"
                    end %>
                    <% if flame_count == 0 %>
                      <span class="text-xs text-content-muted">None</span>
                    <% else %>
                      <div class="flex -space-x-1">
                        <% flame_count.times do |i| %>
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 <%= flame_color %>">
                            <path fill-rule="evenodd" d="M12.963 2.286a.75.75 0 0 0-1.071-.136 9.742 9.742 0 0 0-3.539 6.176 7.547 7.547 0 0 1-1.705-1.715.75.75 0 0 0-1.152-.082A9 9 0 1 0 15.68 4.534a7.46 7.46 0 0 1-2.717-2.248ZM15.75 14.25a3.75 3.75 0 1 1-7.313-1.172c.628.465 1.35.81 2.133 1a5.99 5.99 0 0 1 1.925-3.546 3.75 3.75 0 0 1 3.255 3.718Z" clip-rule="evenodd" />
                          </svg>
                        <% end %>
                      </div>
                    <% end %>
                  </td>
                  <td class="px-4 py-3 text-xs text-content-muted hidden md:table-cell">
                    <%= time_ago_in_words(task.updated_at) %> ago
                  </td>
                  <td class="px-4 py-3 text-right">
                    <%= button_to move_board_task_path(@board, task),
                        method: :patch,
                        params: { status: "done" },
                        class: "inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-content-secondary bg-bg-elevated hover:bg-bg-hover rounded transition-colors",
                        title: "Unarchive (move back to Done)" do %>
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3.5 h-3.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" />
                      </svg>
                      Unarchive
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

        <%# Pagination %>
        <% if @total_pages > 1 %>
          <div class="flex items-center justify-center gap-2 mt-6">
            <% if @page > 1 %>
              <%= link_to archived_board_path(@board, page: @page - 1),
                  class: "px-3 py-1.5 text-sm text-content-secondary bg-bg-surface hover:bg-bg-hover border border-border rounded transition-colors" do %>
                ‚Üê Previous
              <% end %>
            <% end %>
            
            <span class="px-3 py-1.5 text-sm text-content-muted">
              Page <%= @page %> of <%= @total_pages %>
            </span>
            
            <% if @page < @total_pages %>
              <%= link_to archived_board_path(@board, page: @page + 1),
                  class: "px-3 py-1.5 text-sm text-content-secondary bg-bg-surface hover:bg-bg-hover border border-border rounded transition-colors" do %>
                Next ‚Üí
              <% end %>
            <% end %>
          </div>
        <% end %>

      <% else %>
        <%# Empty State %>
        <div class="bg-bg-surface border border-border rounded-lg p-12 text-center">
          <div class="text-4xl mb-4">üì¶</div>
          <h2 class="text-lg font-semibold text-content mb-2">No archived tasks</h2>
          <p class="text-sm text-content-muted mb-4">
            Tasks moved to archive will appear here. Use the "NEXT" button on Done tasks to archive them.
          </p>
          <%= link_to board_path(@board), class: "inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-content bg-accent hover:bg-accent-hover rounded-md transition-colors" do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
            </svg>
            Back to board
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <%# Task Panel Container - loaded via Turbo Frame %>
  <%= turbo_frame_tag "task_panel" %>
</div>
