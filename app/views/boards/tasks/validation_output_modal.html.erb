<%= turbo_frame_tag "validation_output_modal" do %>
  <div class="fixed inset-0 z-50 flex items-center justify-center" data-controller="modal" data-action="keydown.esc->modal#close">
    <div class="absolute inset-0 bg-black/60" data-action="click->modal#close"></div>
    <div class="relative bg-bg-surface border border-border rounded-xl shadow-2xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-hidden flex flex-col">

      <!-- Header -->
      <div class="px-5 py-4 border-b border-border flex items-center justify-between flex-shrink-0">
        <div class="flex items-center gap-3">
          <span class="text-sm font-semibold text-content font-display">Validation Output</span>
          <% validation_badge_class = case @task.validation_status
            when "passed" then "bg-green-500/20 text-green-400"
            when "failed" then "bg-red-500/20 text-red-400"
            when "pending" then "bg-yellow-500/20 text-yellow-400"
            else "bg-gray-500/20 text-gray-400"
          end %>
          <% validation_icon = case @task.validation_status
            when "passed" then "âœ…"
            when "failed" then "âŒ"
            when "pending" then "â³"
            else "ðŸ”"
          end %>
          <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium <%= validation_badge_class %>">
            <%= validation_icon %> <%= @task.validation_status&.capitalize || "Not run" %>
          </span>
        </div>
        <%= link_to board_path(@board), class: "p-2 rounded-lg text-content-muted hover:text-content hover:bg-bg-elevated transition-colors", data: { turbo_frame: "_top" } do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
        <% end %>
      </div>

      <!-- Content -->
      <div class="px-5 py-4 overflow-y-auto flex-1">
        <!-- Task Reference -->
        <div class="mb-4 p-3 bg-bg-elevated rounded-lg">
          <div class="flex items-center justify-between">
            <div>
              <span class="text-xs text-content-muted block mb-1">Task:</span>
              <span class="text-sm font-medium text-content"><%= @task.name.truncate(50) %></span>
            </div>
          </div>
        </div>

        <!-- Command -->
        <div class="mb-4">
          <label class="block text-xs font-medium text-content-muted mb-2">Command</label>
          <code class="block w-full px-3 py-2 bg-bg-elevated rounded-lg text-sm font-mono text-content-secondary overflow-x-auto">
            <%= @task.validation_command %>
          </code>
        </div>

        <!-- Output -->
        <div>
          <label class="block text-xs font-medium text-content-muted mb-2">Output</label>
          <% if @task.validation_output.present? %>
            <pre class="w-full px-3 py-3 bg-bg-elevated rounded-lg text-xs font-mono text-content-secondary overflow-x-auto whitespace-pre-wrap max-h-72 overflow-y-auto"><%= h @task.validation_output %></pre>
          <% else %>
            <div class="w-full px-3 py-4 bg-bg-elevated rounded-lg text-sm text-content-muted text-center">
              No output recorded
            </div>
          <% end %>
        </div>
      </div>

      <!-- Footer -->
      <div class="px-5 py-4 border-t border-border flex items-center justify-end gap-3 flex-shrink-0">
        <%= button_to revalidate_board_task_path(@board, @task),
            method: :post,
            class: "inline-flex items-center gap-2 px-4 py-2 bg-accent hover:bg-accent/90 text-white text-sm font-medium rounded-lg transition-colors cursor-pointer" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />
          </svg>
          Re-run Validation
        <% end %>
        <%= link_to "Close", board_path(@board), class: "px-4 py-2 text-sm font-medium text-content-muted hover:text-content transition-colors", data: { turbo_frame: "_top" } %>
      </div>
    </div>
  </div>
<% end %>
