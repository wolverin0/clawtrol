<%
  column_labels = {
    "inbox" => "Inbox",
    "up_next" => "Up Next",
    "in_progress" => "In Progress",
    "in_review" => "In Review",
    "done" => "Done"
  }
  column_colors = {
    "inbox" => "bg-content-muted",
    "up_next" => "bg-status-info",
    "in_progress" => "bg-status-warning",
    "in_review" => "bg-purple-500",
    "done" => "bg-status-success"
  }
%>

<div class="w-full md:w-72 lg:flex-1 lg:min-w-[240px] lg:max-w-[320px] flex-shrink-0 flex flex-col bg-bg-surface rounded-lg border border-border transition-colors column-<%= status.dasherize %>"
     data-controller="inline-add"
     data-inline-add-status-value="<%= status %>"
     data-inline-add-url-value="<%= board_tasks_path(@board) %>"
     data-status="<%= status %>"
     data-column-status="<%= status %>"
     data-mobile-columns-target="column">
  <%# Column Header %>
  <div class="flex items-center gap-2 px-3 py-3">
    <div class="w-2 h-2 rounded-full <%= column_colors[status] %>"></div>
    <h2 class="text-sm font-semibold text-content font-display"><%= column_labels[status] %></h2>
    <span id="column-<%= status %>-count" class="ml-auto text-xs text-content-secondary bg-bg-elevated px-1.5 py-0.5 rounded"><%= tasks.count %></span>
    <% if status == "done" && tasks.any? %>
      <button type="button"
              data-archive-done-btn
              data-action="click->bulk-operations#archiveAllDone"
              class="hidden text-xs text-content-muted hover:text-accent transition-colors cursor-pointer"
              title="Archive all done tasks">
        ğŸ“¦
      </button>
    <% end %>
  </div>

  <%# Tasks List - no overflow, grows with content, min height for empty drop target %>
  <ul id="column-<%= status %>"
      class="px-2 pb-2 space-y-2 min-h-[2rem] w-full overflow-hidden"
      data-controller="sortable"
      data-sortable-group-value="board"
      data-sortable-status-value="<%= status %>"
      data-sortable-url-value="<%= update_task_status_board_path(@board) %>">
    <% tasks.each do |task| %>
      <%= render "boards/task_card", task: task %>
    <% end %>
  </ul>

  <%# Inline Add Card Form (hidden by default) %>
  <div data-inline-add-target="form" class="hidden px-2 py-2">
    <div class="bg-bg-elevated rounded-lg border border-border p-2">
      <textarea data-inline-add-target="input"
                data-action="keydown->inline-add#handleKeydown input->inline-add#handleInput"
                placeholder="Enter a title... or /review, /bug, /test..."
                rows="3"
                class="w-full bg-transparent text-sm text-content placeholder-content-muted resize-none focus:outline-none"></textarea>
      <%# Template hint %>
      <div data-inline-add-target="hint" class="hidden text-xs mb-2 px-1"></div>
      <%# Template dropdown %>
      <div class="flex items-center gap-2 mt-2">
        <select data-inline-add-target="templateSelect"
                data-action="change->inline-add#applyTemplate"
                class="flex-1 text-xs bg-bg-surface border border-border rounded px-2 py-1.5 text-content-muted focus:outline-none focus:border-accent cursor-pointer">
          <option value="">Quick add...</option>
          <option value="review">ğŸ” Code Review</option>
          <option value="bug">ğŸ› Bug Fix</option>
          <option value="doc">ğŸ“ Documentation</option>
          <option value="test">ğŸ§ª Write Tests</option>
          <option value="research">ğŸ”¬ Research</option>
        </select>
        <button type="button"
                data-action="click->inline-add#submit"
                class="px-3 py-1.5 text-xs font-semibold rounded bg-accent text-content hover:bg-accent-hover transition-colors cursor-pointer">
          Add card
        </button>
        <button type="button"
                data-action="click->inline-add#cancel"
                class="p-1.5 text-content-muted hover:text-content transition-colors cursor-pointer">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <%# Add Card Button (shown by default) %>
  <div data-inline-add-target="button" class="px-2 py-2">
    <button type="button"
            data-action="click->inline-add#show"
            class="w-full flex items-center gap-1 px-2 py-1.5 text-xs text-content-muted hover:text-content hover:bg-bg-hover rounded-md transition-colors cursor-pointer">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
      </svg>
      Add a card
    </button>
  </div>
</div>
