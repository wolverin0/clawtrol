<% content_for :title, "Settings" %>
<% content_for :breadcrumb_standalone, "Settings" %>

<div class="space-y-8 mt-12">
  <!-- Section 1: Avatar -->
  <div>
    <h3 class="text-xs font-medium text-content-muted uppercase tracking-wider mb-3 font-display">Avatar</h3>
    <%= form_with(model: @user, url: settings_path, method: :patch, class: "space-y-3") do |form| %>
      <div class="bg-bg-elevated rounded-md p-4">
        <div class="flex items-center gap-4">
          <% if @user.avatar.attached? %>
            <%= image_tag @user.avatar, class: "w-16 h-16 object-cover rounded-full" %>
          <% else %>
            <div class="w-16 h-16 rounded-full bg-bg-surface flex items-center justify-center">
              <svg class="w-8 h-8 text-content-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
          <% end %>
          <div class="flex-1">
            <%= form.file_field :avatar, accept: "image/jpeg,image/jpg,image/png,image/webp", class: "block w-full text-xs text-content-secondary file:mr-3 file:py-1.5 file:px-3 file:rounded-md file:border-0 file:text-xs file:font-medium file:bg-bg-surface file:text-content-secondary hover:file:bg-bg-hover file:cursor-pointer file:transition-colors" %>
            <p class="text-xs text-content-muted mt-1">Max 512KB, 256x256px. JPEG, PNG, or WebP.</p>
          </div>
        </div>
        <% if @user.avatar.attached? %>
          <div class="mt-3 pt-3 border-t border-border">
            <label class="flex items-center text-xs text-content-secondary cursor-pointer">
              <%= form.check_box :remove_avatar, class: "mr-2 rounded border-border bg-bg-surface text-accent focus:ring-accent focus:ring-offset-bg-surface" %>
              Remove avatar
            </label>
          </div>
        <% end %>
      </div>
      <% if @user.errors[:avatar].any? %>
        <div class="mt-2">
          <% @user.errors[:avatar].each do |error| %>
            <p class="text-status-error text-xs">Avatar <%= error %></p>
          <% end %>
        </div>
      <% end %>
      <div class="flex items-center gap-2 pt-2">
        <%= form.submit "Save avatar", class: "cursor-pointer px-4 py-2 bg-accent text-content hover:bg-accent-hover text-xs font-semibold rounded-md transition-colors duration-200" %>
      </div>
    <% end %>
  </div>

  <!-- Section 2: Email -->
  <div class="">
    <h3 class="text-xs font-medium text-content-muted uppercase tracking-wider mb-3 font-display">Email Address</h3>
    <%= form_with(model: @user, url: settings_path, method: :patch, class: "space-y-3") do |form| %>
      <div class="bg-bg-elevated rounded-md p-4">
        <%= form.label :email_address, "Email", class: "block text-xs font-medium text-content-secondary mb-1" %>
        <%= form.email_field :email_address, placeholder: "your@email.com", class: "block w-full bg-transparent border-0 p-0 text-sm text-content placeholder:text-content-muted focus:ring-0 focus:outline-none" %>
      </div>
      <% if @user.errors[:email_address].any? %>
        <div class="mt-2">
          <% @user.errors[:email_address].each do |error| %>
            <p class="text-status-error text-xs">Email <%= error %></p>
          <% end %>
        </div>
      <% end %>
      <div class="flex items-center gap-2 pt-2">
        <%= form.submit "Update email", class: "cursor-pointer px-4 py-2 bg-accent text-content hover:bg-accent-hover text-xs font-semibold rounded-md transition-colors duration-200" %>
      </div>
    <% end %>
  </div>

  <!-- Section 3: API Token -->
  <div>
    <h3 class="text-xs font-medium text-content-muted uppercase tracking-wider mb-3 font-display">API Token</h3>
    <div class="bg-bg-elevated rounded-md p-4 space-y-4">
      <div>
        <label class="block text-xs font-medium text-content-secondary mb-2">Your API Token</label>
        <div class="flex items-center gap-2" data-controller="clipboard">
          <code
            data-clipboard-target="source"
            class="flex-1 bg-bg-surface px-3 py-2 rounded text-xs font-mono text-content-secondary select-all break-all"
          ><%= @api_token.token %></code>
          <button
            type="button"
            data-action="click->clipboard#copy"
            class="px-3 py-2 bg-bg-surface hover:bg-bg-hover text-content-secondary text-xs font-medium rounded transition-colors"
          >
            <span data-clipboard-target="label">Copy</span>
          </button>
        </div>
        <p class="text-xs text-content-muted mt-2">
          Last used: <%= @api_token.last_used_at ? time_ago_in_words(@api_token.last_used_at) + " ago" : "Never" %>
        </p>
      </div>

      <div class="pt-3 border-t border-border">
        <label class="block text-xs font-medium text-content-secondary mb-2">Clawdbot Setup Prompt</label>
        <p class="text-xs text-content-muted mb-2">Send this to your Clawdbot to set up the ClawDeck integration:</p>
        <div data-controller="clipboard">
          <pre
            data-clipboard-target="source"
            class="bg-bg-surface px-3 py-2 rounded text-xs font-mono text-content-secondary overflow-x-auto whitespace-pre-wrap break-all"
>I use ClawDeck (clawdeck.so) for task management. Set yourself up to work with it.

Add this to your TOOLS.md:

### ClawDeck API
- URL: `https://clawdeck.so/api/v1`
- Token: `<%= @api_token.token %>`
- Auth: `Authorization: Bearer <token>`
- Endpoints:
  - `/tasks` - GET (list all), POST (create task)
  - `/tasks/:id` - GET, PATCH, DELETE
  - `/tasks/:id/complete` - PATCH (toggle complete)
  - `/tasks/:id/comments` - GET, POST

**Task statuses:** inbox, up_next, in_progress, in_review, done

**Quick Capture patterns:**
- "task: <task>" or "remind me to <task>" → create in inbox
- Keywords: "tomorrow", "friday", "next week" → set due_date
- Keywords: "urgent", "!", "high priority" → priority: high
- Keywords: "blocked" → blocked: true</pre>
          <button
            type="button"
            data-action="click->clipboard#copy"
            class="mt-2 px-3 py-1.5 bg-bg-surface hover:bg-bg-hover text-content-secondary text-xs font-medium rounded transition-colors"
          >
            <span data-clipboard-target="label">Copy prompt</span>
          </button>
        </div>
      </div>

      <div class="pt-3 border-t border-border">
        <%= button_to "Regenerate token", regenerate_api_token_settings_path,
            method: :post,
            data: { confirm: "This will invalidate your current token. Continue?" },
            class: "px-3 py-1.5 bg-status-error/20 hover:bg-status-error/30 text-status-error text-xs font-medium rounded transition-colors" %>
      </div>
    </div>
  </div>

</div>
