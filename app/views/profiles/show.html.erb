<% content_for :title, "Settings" %>
<% content_for :breadcrumb_standalone, "Settings" %>

<div class="space-y-8">
  <!-- Section 1: Avatar -->
  <div>
    <h3 class="text-xs font-medium text-stone-400 dark:text-white/50 uppercase tracking-wider mb-3">Avatar</h3>
    <%= form_with(model: @user, url: profile_path, method: :patch, class: "space-y-3") do |form| %>
      <div class="bg-stone-100 dark:bg-white/10 rounded-md p-4">
        <div class="flex items-center gap-4">
          <% if @user.avatar.attached? %>
            <%= image_tag @user.avatar, class: "w-16 h-16 object-cover rounded-full" %>
          <% else %>
            <div class="w-16 h-16 rounded-full bg-stone-200 dark:bg-stone-800 flex items-center justify-center">
              <svg class="w-8 h-8 text-stone-400 dark:text-stone-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
          <% end %>
          <div class="flex-1">
            <%= form.file_field :avatar, accept: "image/jpeg,image/jpg,image/png,image/webp", class: "block w-full text-xs text-stone-500 dark:text-white/60 file:mr-3 file:py-1.5 file:px-3 file:rounded-md file:border-0 file:text-xs file:font-medium file:bg-stone-200 dark:file:bg-white/10 file:text-stone-600 dark:file:text-white/70 hover:file:bg-stone-300 dark:hover:file:bg-white/20 file:cursor-pointer file:transition-colors" %>
            <p class="text-xs text-stone-400 dark:text-white/40 mt-1">Max 512KB, 256x256px. JPEG, PNG, or WebP.</p>
          </div>
        </div>
        <% if @user.avatar.attached? %>
          <div class="mt-3 pt-3 border-t border-stone-200 dark:border-white/10">
            <label class="flex items-center text-xs text-stone-500 dark:text-white/60 cursor-pointer">
              <%= form.check_box :remove_avatar, class: "mr-2 rounded border-stone-300 dark:border-white/30 text-lime-600 focus:ring-lime-500" %>
              Remove avatar
            </label>
          </div>
        <% end %>
      </div>
      <% if @user.errors[:avatar].any? %>
        <div class="mt-2">
          <% @user.errors[:avatar].each do |error| %>
            <p class="text-red-500 dark:text-red-400 text-xs">Avatar <%= error %></p>
          <% end %>
        </div>
      <% end %>
      <div class="flex items-center gap-2 pt-2">
        <%= form.submit "Save avatar", class: "cursor-pointer px-4 py-2 bg-purple-600 dark:bg-white text-white dark:text-stone-900 hover:bg-purple-500 dark:hover:bg-stone-200 text-xs font-semibold rounded-sm transition-colors duration-200" %>
      </div>
    <% end %>
  </div>

  <!-- Section 2: Email -->
  <div class="">
    <h3 class="text-xs font-medium text-stone-400 dark:text-white/50 uppercase tracking-wider mb-3">Email Address</h3>
    <%= form_with(model: @user, url: profile_path, method: :patch, class: "space-y-3") do |form| %>
      <div class="bg-stone-100 dark:bg-white/10 rounded-md p-4">
        <%= form.label :email_address, "Email", class: "block text-xs font-medium text-stone-500 dark:text-white/70 mb-1" %>
        <%= form.email_field :email_address, placeholder: "your@email.com", class: "block w-full bg-transparent border-0 p-0 text-sm text-stone-900 dark:text-stone-100 placeholder:text-stone-400 dark:placeholder:text-white/40 focus:ring-0 focus:outline-none" %>
      </div>
      <% if @user.errors[:email_address].any? %>
        <div class="mt-2">
          <% @user.errors[:email_address].each do |error| %>
            <p class="text-red-500 dark:text-red-400 text-xs">Email <%= error %></p>
          <% end %>
        </div>
      <% end %>
      <div class="flex items-center gap-2 pt-2">
        <%= form.submit "Update email", class: "cursor-pointer px-4 py-2 bg-purple-600 dark:bg-white text-white dark:text-stone-900 hover:bg-purple-500 dark:hover:bg-stone-200 text-xs font-semibold rounded-sm transition-colors duration-200" %>
      </div>
    <% end %>
  </div>

  <!-- Section 3: API Token -->
  <div>
    <h3 class="text-xs font-medium text-stone-400 dark:text-white/50 uppercase tracking-wider mb-3">API Token</h3>
    <div class="bg-stone-100 dark:bg-white/10 rounded-md p-4 space-y-4">
      <div>
        <label class="block text-xs font-medium text-stone-500 dark:text-white/70 mb-2">Your API Token</label>
        <div class="flex items-center gap-2" data-controller="clipboard">
          <code 
            data-clipboard-target="source"
            class="flex-1 bg-stone-200 dark:bg-black/30 px-3 py-2 rounded text-xs font-mono text-stone-700 dark:text-stone-300 select-all break-all"
          ><%= @api_token.token %></code>
          <button 
            type="button"
            data-action="click->clipboard#copy"
            class="px-3 py-2 bg-stone-200 dark:bg-white/10 hover:bg-stone-300 dark:hover:bg-white/20 text-stone-600 dark:text-white/70 text-xs font-medium rounded transition-colors"
          >
            <span data-clipboard-target="label">Copy</span>
          </button>
        </div>
        <p class="text-xs text-stone-400 dark:text-white/40 mt-2">
          Last used: <%= @api_token.last_used_at ? time_ago_in_words(@api_token.last_used_at) + " ago" : "Never" %>
        </p>
      </div>

      <div class="pt-3 border-t border-stone-200 dark:border-white/10">
        <label class="block text-xs font-medium text-stone-500 dark:text-white/70 mb-2">Clawdbot Setup Prompt</label>
        <p class="text-xs text-stone-400 dark:text-white/50 mb-2">Send this to your Clawdbot to set up the ClawDeck integration:</p>
        <div data-controller="clipboard">
          <pre
            data-clipboard-target="source"
            class="bg-stone-200 dark:bg-black/30 px-3 py-2 rounded text-xs font-mono text-stone-700 dark:text-stone-300 overflow-x-auto whitespace-pre-wrap break-all"
>I use ClawDeck (clawdeck.so) for task management. Set yourself up to work with it.

Add this to your TOOLS.md:

### ClawDeck API
- URL: `https://clawdeck.so/api/v1`
- Token: `<%= @api_token.token %>`
- Auth: `Authorization: Bearer <token>`
- Endpoints:
  - `/tasks` - GET (list all), POST (create task)
  - `/tasks/:id` - GET, PATCH, DELETE
  - `/tasks/:id/complete` - PATCH (toggle complete)
  - `/tasks/:id/comments` - GET, POST

**Task statuses:** inbox, up_next, in_progress, in_review, done

**Quick Capture patterns:**
- "task: <task>" or "remind me to <task>" → create in inbox
- Keywords: "tomorrow", "friday", "next week" → set due_date
- Keywords: "urgent", "!", "high priority" → priority: high
- Keywords: "blocked" → blocked: true</pre>
          <button
            type="button"
            data-action="click->clipboard#copy"
            class="mt-2 px-3 py-1.5 bg-stone-200 dark:bg-white/10 hover:bg-stone-300 dark:hover:bg-white/20 text-stone-600 dark:text-white/70 text-xs font-medium rounded transition-colors"
          >
            <span data-clipboard-target="label">Copy prompt</span>
          </button>
        </div>
      </div>

      <div class="pt-3 border-t border-stone-200 dark:border-white/10">
        <%= button_to "Regenerate token", regenerate_api_token_profile_path, 
            method: :post,
            data: { confirm: "This will invalidate your current token. Continue?" },
            class: "px-3 py-1.5 bg-red-100 dark:bg-red-900/30 hover:bg-red-200 dark:hover:bg-red-900/50 text-red-600 dark:text-red-400 text-xs font-medium rounded transition-colors" %>
      </div>
    </div>
  </div>

</div>
