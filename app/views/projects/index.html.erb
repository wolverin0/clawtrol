<% content_for :title, "Projects - clawdeck" %>
<section id="projects" class="space-y-6">
  <ul id="projects-list"
      class="space-y-2"
      data-controller="projects-sortable"
      data-projects-sortable-url-value="<%= reorder_projects_path %>"
      data-projects-sortable-sync-value="sidebar-projects">
    <% @projects.each do |project| %>
      <li data-project-id="<%= project.id %>">
        <%= link_to project_path(project), class: "project-card bg-stone-100 hover:bg-stone-200 dark:bg-white/10 dark:hover:bg-white/20 p-5 rounded-md h-16 flex items-center transition-colors group", aria: { label: "Open #{project.title}" } do %>
          <!-- Project image thumbnail on the left -->
          <div class="w-8 h-8 rounded-md overflow-hidden mr-4 flex-shrink-0 bg-white dark:bg-white/5 flex items-center justify-center"
               data-controller="image-brightness"
               data-image-brightness-threshold-value="180"
               data-image-brightness-max-size-value="100">
            <%= image_tag project.image_url,
                class: "w-full h-full object-cover",
                data: { image_brightness_target: "image" },
                alt: "#{project.title} thumbnail" %>
          </div>
          <!-- Centered title -->
          <div class="flex-1 text-left">
            <span class="tracking-tight leading-tight"><%= project.title %></span>
          </div>
          <!-- Progress bar before arrow -->
          <% total_tasks = project.cached_task_count %>
          <% completed_tasks = project.cached_completed_task_count %>
          <% progress_percentage = total_tasks > 0 ? (completed_tasks.to_f / total_tasks * 100).round : 0 %>
          <div class="ml-4 flex-shrink-0 w-16" role="progressbar" aria-valuenow="<%= progress_percentage %>" aria-valuemin="0" aria-valuemax="100" aria-label="Project progress: <%= progress_percentage %>%">
            <div class="w-full bg-stone-200 dark:bg-white/20 group-hover:bg-stone-300 dark:group-hover:bg-white/20 rounded-full h-1 overflow-hidden transition-colors">
              <div class="bg-lime-500 h-1 rounded-full transition-all duration-300 ease-out"
                   style="width: <%= progress_percentage %>%">
              </div>
            </div>
          </div>
          <!-- Arrow on the right -->
          <div class="ml-3 flex-shrink-0 leading-tight" aria-hidden="true">
            &rarr;
          </div>
        <% end %>
      </li>
    <% end %>
    <!-- New project link -->
    <li data-sortable-exclude>
      <%= link_to new_project_path, class: "w-full bg-stone-100 hover:bg-stone-200 dark:bg-white/10 dark:hover:bg-white/20 p-5 rounded-md h-16 flex items-center justify-center transition-colors", aria: { label: "Add new project" } do %>
        <svg class="w-5 h-5 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
      <% end %>
    </li>
  </ul>
</section>