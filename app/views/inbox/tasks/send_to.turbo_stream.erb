<%# Remove the task from the DOM in the inbox %>
<%= turbo_stream.remove "task_#{@task_id}" %>

<%# Update progress bar and completed section visibility %>
<%= turbo_stream.append "tasks" do %>
  <script>
    (() => {
      // Dispatch event to update progress bar for inbox page
      window.dispatchEvent(new CustomEvent('task:deleted', {
        detail: {
          totalTasks: <%= @inbox.tasks.count %>,
          completedTasks: <%= @inbox.tasks.where(completed: true).count %>
        }
      }));

      // Hide completed section if no completed tasks
      <% task_list = @inbox.task_list %>
      <% task_list_completed = task_list.tasks.completed.count %>
      const completedSection = document.getElementById('completed-section-<%= task_list.id %>');
      const completedTasks = <%= task_list_completed %>;
      if (completedSection && completedTasks === 0) {
        completedSection.classList.add('hidden');
      }
    })();
  </script>
<% end %>

<%# Flash message %>
<%= turbo_stream.append "tasks" do %>
  <div class="fixed top-4 left-1/2 -translate-x-1/2 z-[100] pointer-events-none">
    <div data-controller="flash" class="py-1.5 px-3 bg-lime-50 dark:bg-lime-900/30 text-lime-600 dark:text-lime-400 text-xs font-medium rounded-md transition-opacity duration-500 shadow-sm whitespace-nowrap" role="alert">
      <%= notice_message %>
    </div>
  </div>
<% end %>

<%# Update sidebar badges %>
<%= render "application/sidebar_badges" %>
