<% content_for :title, "Board - clawdeck" %>
<% @board_page = true %>

<div class="h-full flex flex-col" data-controller="board">
  <%# Board Header %>
  <%= render "board/header" %>

  <%# Tag filter indicator %>
  <% if @current_tag.present? %>
    <div class="flex items-center gap-2 px-4 py-2 bg-stone-50 dark:bg-stone-800/50 border-b border-stone-200 dark:border-white/10">
      <span class="text-xs text-stone-500 dark:text-white/50">Filtered by:</span>
      <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-stone-200 dark:bg-white/20 text-stone-700 dark:text-white/90">
        <%= @current_tag %>
        <%= link_to board_path, class: "ml-1 hover:text-red-500" do %>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3">
            <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
          </svg>
        <% end %>
      </span>
    </div>
  <% end %>

  <%# Kanban Columns %>
  <div class="flex-1 overflow-x-auto overflow-y-hidden bg-stone-100 dark:bg-stone-900">
    <div class="flex gap-4 p-4 h-full min-w-max">
      <% Task.statuses.keys.each do |status| %>
        <%= render "board/column", status: status, tasks: @columns[status.to_sym] %>
      <% end %>
    </div>
  </div>
</div>

<%# Task Detail Slide-out Panel %>
<div data-board-target="slidePanel"
     class="fixed inset-y-0 right-0 w-full max-w-md bg-white dark:bg-stone-800 shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out z-50 flex flex-col">
  <div data-board-target="slidePanelContent" class="flex-1 overflow-y-auto">
    <%# Content loaded via Turbo Frame %>
  </div>
</div>
<div data-board-target="slideOverlay"
     data-action="click->board#closeSlidePanel"
     class="fixed inset-0 bg-black/20 dark:bg-black/40 opacity-0 pointer-events-none transition-opacity duration-300 z-40">
</div>

<%# New Task Modal %>
<%= turbo_frame_tag "new_task_modal" %>
