<% content_for :title, "Board - clawdeck" %>
<% @board_page = true %>

<%# Subscribe to real-time updates for this user's board %>
<%= turbo_stream_from "user_#{current_user.id}_board" %>

<div class="h-full flex flex-col" data-controller="board">
  <%# Board Header %>
  <%= render "board/header" %>

  <%# Tag filter indicator %>
  <% if @current_tag.present? %>
    <div class="flex items-center gap-2 px-6 py-2 bg-bg-surface border-b border-border">
      <span class="text-xs text-content-muted">Filtered by:</span>
      <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-bg-elevated text-content">
        <%= @current_tag %>
        <%= link_to board_path, class: "ml-1 hover:text-accent" do %>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3">
            <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
          </svg>
        <% end %>
      </span>
    </div>
  <% end %>

  <%# Kanban Columns %>
  <div class="flex-1 overflow-hidden bg-bg-base">
    <div class="flex gap-4 px-6 py-4 h-full">
      <% Task.statuses.keys.each do |status| %>
        <%= render "board/column", status: status, tasks: @columns[status.to_sym] %>
      <% end %>
    </div>
  </div>

  <%# Task Panel Container - loaded via Turbo Frame %>
  <%= turbo_frame_tag "task_panel" %>

  <%# New Task Modal %>
  <%= turbo_frame_tag "new_task_modal" %>
</div>
