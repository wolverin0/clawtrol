<% content_for :title, "Identity & Branding - clawdeck" %>
<% content_for :breadcrumb_standalone, "ðŸŽ¨ Identity & Branding" %>

<div class="py-6 space-y-6">
  <div>
    <h1 class="text-xl font-bold text-content">Identity & Branding</h1>
    <p class="text-sm text-content-muted mt-1">
      Set your bot's name, emoji, avatar, and message formatting preferences.
    </p>
  </div>

  <% if @error.present? %>
    <%= render "shared/error_alert", message: @error %>
  <% end %>

  <%= form_with url: identity_config_path, method: :patch, class: "space-y-6" do |f| %>

    <%# Identity %>
    <div class="bg-bg-elevated border border-border rounded-xl p-5">
      <h3 class="text-base font-semibold text-content mb-4">ðŸ¤– Bot Identity</h3>

      <%# Preview card %>
      <div class="mb-6 p-4 bg-bg-base rounded-xl border border-border max-w-sm mx-auto">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-accent/20 flex items-center justify-center text-xl">
            <%= @identity[:emoji].presence || "ðŸ¤–" %>
          </div>
          <div>
            <div class="text-sm font-medium text-content"><%= @identity[:name].presence || "Bot Name" %></div>
            <div class="text-xs text-content-muted">Online</div>
          </div>
        </div>
        <div class="mt-3 p-2 bg-accent/5 rounded-lg text-sm text-content">
          <% if @messages[:prefix].present? %>
            <span class="text-content-muted"><%= @messages[:prefix] %></span>
          <% end %>
          Hello! I'm your assistant.
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-content-muted mb-1">Bot Name</label>
          <input type="text" name="name"
                 value="<%= @identity[:name] %>"
                 class="w-full px-3 py-2 bg-bg-base border border-border rounded-lg text-sm text-content focus:ring-2 focus:ring-accent/40"
                 placeholder="Otacon">
        </div>
        <div>
          <label class="block text-sm text-content-muted mb-1">Emoji</label>
          <input type="text" name="emoji"
                 value="<%= @identity[:emoji] %>"
                 class="w-full px-3 py-2 bg-bg-base border border-border rounded-lg text-sm text-content focus:ring-2 focus:ring-accent/40"
                 placeholder="ðŸ“Ÿ">
        </div>
        <div>
          <label class="block text-sm text-content-muted mb-1">Theme</label>
          <select name="theme"
                  class="w-full px-3 py-2 bg-bg-base border border-border rounded-lg text-sm text-content focus:ring-2 focus:ring-accent/40">
            <option value="" <%= "selected" if @identity[:theme].blank? %>>Default</option>
            <% %w[dark light vaporwave minimal professional].each do |t| %>
              <option value="<%= t %>" <%= "selected" if @identity[:theme] == t %>><%= t.capitalize %></option>
            <% end %>
          </select>
        </div>
        <div>
          <label class="block text-sm text-content-muted mb-1">Avatar URL</label>
          <input type="text" name="avatar"
                 value="<%= @identity[:avatar] %>"
                 class="w-full px-3 py-2 bg-bg-base border border-border rounded-lg text-sm text-content focus:ring-2 focus:ring-accent/40"
                 placeholder="https://example.com/avatar.png or avatars/bot.png">
        </div>
      </div>
    </div>

    <%# Message Formatting %>
    <div class="bg-bg-elevated border border-border rounded-xl p-5">
      <h3 class="text-base font-semibold text-content mb-4">ðŸ’¬ Message Formatting</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-content-muted mb-1">Message Prefix</label>
          <input type="text" name="prefix"
                 value="<%= @messages[:prefix] %>"
                 class="w-full px-3 py-2 bg-bg-base border border-border rounded-lg text-sm text-content focus:ring-2 focus:ring-accent/40"
                 placeholder="[Bot]">
          <p class="text-xs text-content-muted mt-1">Prepended to every outgoing message.</p>
        </div>
        <div>
          <label class="block text-sm text-content-muted mb-1">Response Prefix</label>
          <input type="text" name="response_prefix"
                 value="<%= @messages[:response_prefix] %>"
                 class="w-full px-3 py-2 bg-bg-base border border-border rounded-lg text-sm text-content focus:ring-2 focus:ring-accent/40"
                 placeholder="">
          <p class="text-xs text-content-muted mt-1">Added before the AI response content.</p>
        </div>
        <div>
          <label class="block text-sm text-content-muted mb-1">Ack Reaction</label>
          <input type="text" name="ack_reaction"
                 value="<%= @messages[:ack_reaction] %>"
                 class="w-full px-3 py-2 bg-bg-base border border-border rounded-lg text-sm text-content focus:ring-2 focus:ring-accent/40"
                 placeholder="ðŸ‘€ or ðŸ”„">
          <p class="text-xs text-content-muted mt-1">Emoji reaction added when processing starts.</p>
        </div>
        <div>
          <label class="block text-sm text-content-muted mb-1">Ack Scope</label>
          <select name="ack_reaction_scope"
                  class="w-full px-3 py-2 bg-bg-base border border-border rounded-lg text-sm text-content focus:ring-2 focus:ring-accent/40">
            <% %w[all direct group none].each do |scope| %>
              <option value="<%= scope %>" <%= "selected" if @messages[:ack_reaction_scope] == scope %>><%= scope.capitalize %></option>
            <% end %>
          </select>
          <p class="text-xs text-content-muted mt-1">Where to apply the ack reaction.</p>
        </div>
      </div>
    </div>

    <div class="flex justify-end">
      <button type="submit"
              class="px-6 py-2 bg-accent text-white rounded-lg font-medium text-sm hover:bg-accent/80 transition-colors">
        ðŸ’¾ Save Identity & Branding
      </button>
    </div>
  <% end %>
</div>
