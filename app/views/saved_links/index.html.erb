<% content_for :title, "Link Inbox - clawdeck" %>
<% content_for :breadcrumb_standalone, "ðŸ“¥ Link Inbox" %>

<div class="py-6 space-y-6">
  <%# Save Link Form %>
  <div class="bg-bg-elevated border border-border rounded-xl p-5">
    <%= form_with model: SavedLink.new, url: saved_links_path, class: "flex flex-col sm:flex-row gap-3" do |f| %>
      <div class="flex-1">
        <%= f.url_field :url, placeholder: "Paste a URL â€” article, YouTube, X/Twitter, Redditâ€¦",
            class: "w-full bg-bg-base border border-border rounded-lg px-4 py-3 text-content placeholder-content-muted focus:outline-none focus:border-accent focus:ring-1 focus:ring-accent transition-colors",
            required: true, autofocus: true %>
      </div>
      <div class="flex gap-2 items-center">
        <%= f.text_field :title, placeholder: "Title (optional)",
            class: "bg-bg-base border border-border rounded-lg px-4 py-3 text-content placeholder-content-muted focus:outline-none focus:border-accent w-full sm:w-48" %>

        <label class="flex items-center gap-2 text-xs text-content-muted whitespace-nowrap px-3 py-2 bg-bg-base border border-border rounded-lg">
          <%= f.check_box :deep_summary, class: "rounded border-border bg-bg-base text-accent focus:ring-accent" %>
          Deep summary
        </label>

        <%= f.submit "Save Link", class: "bg-accent hover:bg-accent/80 text-white font-medium px-6 py-3 rounded-lg cursor-pointer transition-colors whitespace-nowrap" %>
      </div>
    <% end %>
  </div>

  <%# Stats + Filter %>
  <div class="flex items-center gap-4 text-sm text-content-muted flex-wrap">
    <span><%= @saved_links.count %> links</span>
    <span>Â·</span>
    <% status_counts = current_user.saved_links.group(:status).count %>
    <% %w[pending processing done failed].each do |s| %>
      <% count = status_counts[s] || 0 %>
      <% if count > 0 %>
        <%= link_to saved_links_path(status: s),
            class: "hover:text-accent transition-colors #{'text-accent font-medium' if params[:status] == s}" do %>
          <%= count %> <%= s %>
        <% end %>
      <% end %>
    <% end %>
    <% if params[:status].present? %>
      <%= link_to "Clear filter", saved_links_path, class: "text-accent hover:underline" %>
    <% end %>
  </div>

  <%# Process All Button %>
  <% pending_count = status_counts["pending"] || 0 %>
  <% if pending_count > 0 %>
    <%= button_to "ðŸ¤– Process with Gemini", process_all_saved_links_path, method: :post,
        class: "bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg transition-colors" %>
  <% end %>

  <%# Links List %>
  <% if @saved_links.any? %>
    <div class="space-y-3">
      <%= render @saved_links %>
    </div>
    <%# Pagination %>
    <% if @pagy&.pages.to_i > 1 %>
      <div class="flex items-center justify-center gap-2 pt-4">
        <% if @pagy.prev %>
          <%= link_to "â† Prev", saved_links_path(page: @pagy.prev, status: params[:status]),
              class: "px-3 py-1.5 text-sm rounded-lg bg-bg-elevated border border-border text-content-secondary hover:text-content hover:border-accent/50 transition-colors" %>
        <% end %>
        <span class="text-sm text-content-muted">Page <%= @pagy.page %> of <%= @pagy.pages %></span>
        <% if @pagy.next %>
          <%= link_to "Next â†’", saved_links_path(page: @pagy.next, status: params[:status]),
              class: "px-3 py-1.5 text-sm rounded-lg bg-bg-elevated border border-border text-content-secondary hover:text-content hover:border-accent/50 transition-colors" %>
        <% end %>
      </div>
    <% end %>
    </div>
  <% else %>
    <%= render "shared/empty_state",
      icon: "ðŸ“¥",
      title: "No saved links yet",
      description: "Paste a URL above to get started." %>
  <% end %>
</div>
