<% content_for :title, "ZeroBitch Rules" %>

<div class="py-6 space-y-4">
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-bold text-content">‚öñÔ∏è Auto-scaling Rules</h1>
    <div class="flex items-center gap-2">
      <%= button_to "Evaluate Now", evaluate_zerobitch_rules_path, method: :post, class: "px-3 py-2 rounded-md bg-bg-elevated border border-border text-xs text-content hover:border-accent/40" %>
      <%= link_to "‚ûï New Rule", new_zerobitch_rule_path, class: "px-3 py-2 rounded-md bg-accent text-white text-xs" %>
    </div>
  </div>

  <% if @rules.blank? %>
    <div class="rounded-xl border border-border bg-bg-elevated p-8 text-center">
      <p class="text-content-muted">No rules yet.</p>
      <p class="text-sm text-content-muted mt-1">Create a rule to auto-scale your fleet.</p>
    </div>
  <% else %>
    <div class="space-y-2">
      <% @rules.each do |rule| %>
        <% enabled = rule["enabled"] %>
        <div class="rounded-xl border border-border bg-bg-elevated p-4 <%= enabled ? '' : 'opacity-60' %>">
          <div class="flex items-start justify-between gap-3">
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <span class="text-sm font-semibold text-content"><%= rule["name"] %></span>
                <span class="px-2 py-0.5 rounded-full text-[11px] font-medium border <%= enabled ? 'bg-emerald-500/15 text-emerald-400 border-emerald-500/30' : 'bg-red-500/15 text-red-400 border-red-500/30' %>">
                  <%= enabled ? "ON" : "OFF" %>
                </span>
              </div>
              <div class="mt-2 grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-content-muted">
                <div><span class="text-content-secondary">IF:</span> <%= rule.dig("condition", "type")&.humanize %> ‚Üí threshold: <%= rule.dig("condition", "threshold") %></div>
                <div><span class="text-content-secondary">THEN:</span> <%= rule.dig("action", "type")&.humanize %> <% if rule.dig("action", "template_id").present? %>(template: <%= rule.dig("action", "template_id") %>)<% end %></div>
                <div><span class="text-content-secondary">Last triggered:</span> <%= rule["last_triggered"].presence || "never" %></div>
                <div class="font-mono text-[11px] text-content-muted/60"><%= rule["id"] %></div>
              </div>
            </div>
            <div class="flex items-center gap-1 shrink-0">
              <%= button_to enabled ? "Disable" : "Enable", toggle_zerobitch_rule_path(rule["id"]),
                    method: :post,
                    class: "px-2 py-1 rounded-md text-[11px] border border-border #{enabled ? 'text-yellow-400 hover:bg-yellow-500/10' : 'text-emerald-400 hover:bg-emerald-500/10'}" %>
              <%= button_to "üóë", destroy_zerobitch_rule_path(rule["id"]),
                    method: :delete,
                    class: "px-2 py-1 rounded-md text-[11px] text-red-400 border border-border hover:bg-red-500/10",
                    data: { turbo_confirm: "Delete rule '#{rule['name']}'?" } %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
