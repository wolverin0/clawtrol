# Nightshift Task: <%= task[:name] %>

## Task Description
<%= task[:description] %>
<% if manifest -%>

## Project Context
<% if manifest.is_a?(Hash) && manifest[:raw] -%>
<%= manifest[:raw].to_s.truncate(2000) %>
<% else -%>
<% if manifest[:project] -%>
- **Project**: <%= manifest[:project] %>
<% end -%>
<% if manifest[:stack] -%>
- **Stack**: <%= Array(manifest[:stack]).join(", ") %>
<% end -%>
<% if manifest[:key_files] -%>
- **Key files**: <%= Array(manifest[:key_files]).first(10).join(", ") %>
<% end -%>
<% end -%>
<% end -%>

## Nightshift Rules
- You are running as an **overnight autonomous agent**
- The human operator is asleep â€” do NOT wait for input
- Make incremental, safe changes
- If you encounter a blocker, document it and move to the next sub-task
- **Never** deploy or push to production
- **Never** modify environment variables or secrets
- **Never** delete data or drop tables
<% if task[:validation_command].present? -%>

## Validation
Run this command after each change:
```bash
<%= task[:validation_command] %>
```
If validation fails, revert your change and try a different approach.
<% end -%>
<% if dependencies.any? -%>

## Task Dependencies
<% dependencies.each do |dep| -%>
- **<%= dep[:name] %>**: <%= dep[:status] %><%= dep[:completed] ? " (completed)" : " (pending - do NOT work on this)" %>
<% end -%>
<% end -%>

## Outcome Reporting
When finished, report using the outcome webhook format:
- **achieved**: List of completed items
- **remaining**: List of items not completed
- **evidence**: List of verification results
- **recommended_action**: "in_review" (default) or "requeue_same_task" (if more work needed)
- **needs_follow_up**: true/false
- **next_prompt**: If requeue, describe what to do next
